<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Will you be my Valentine?</title>
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous"
    >
    <style>
        :root {
            --pink-100: #ffe6ef;
            --pink-200: #ffc4dd;
            --pink-300: #ff9cc6;
            --pink-400: #ff6fae;
            --pink-500: #e91e63;
            --purple-500: #a64dff;
            --gold-300: #ffd1a6;
            --card-glow: rgba(255, 255, 255, 0.75);
            --text-dark: #2d2a32;
        }

        * {
            box-sizing: border-box;
        }

        html,
        body {
            min-height: 100%;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100dvh;
            margin: 0;
            padding: 32px 16px 40px;
            background: radial-gradient(circle at top, #fff6fb 0%, #fde9ff 32%, #ffd6ea 68%, #ffcade 100%);
            font-family: 'Poppins', 'Arial', sans-serif;
            overflow-x: hidden;
            overflow-y: auto;
            color: var(--text-dark);
        }

        body::before,
        body::after {
            content: "";
            position: absolute;
            width: 420px;
            height: 420px;
            border-radius: 50%;
            filter: blur(0px);
            opacity: 0.5;
            z-index: 0;
        }

        body::before {
            top: -140px;
            left: -120px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.9), rgba(255, 182, 193, 0));
            animation: floatGlow 12s ease-in-out infinite;
        }

        body::after {
            bottom: -160px;
            right: -90px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.6), rgba(221, 182, 255, 0));
            animation: floatGlow 14s ease-in-out infinite reverse;
        }

        .container {
            position: relative;
            z-index: 1;
            background: rgba(255, 255, 255, 0.82);
            padding: 38px 40px;
            border-radius: 28px;
            text-align: center;
            max-width: 540px;
            width: min(92vw, 540px);
            box-shadow: 0 30px 60px rgba(233, 30, 99, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            animation: cardRise 0.9s ease, softFloat 6s ease-in-out infinite;
            transition: transform 0.35s ease, box-shadow 0.35s ease;
        }

        .container::before {
            content: "";
            position: absolute;
            inset: -2px;
            border-radius: 30px;
            padding: 2px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.9), rgba(255, 182, 193, 0.7), rgba(166, 77, 255, 0.6));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            opacity: 0.75;
            pointer-events: none;
            animation: borderGlow 6s ease-in-out infinite;
        }

        .container:hover {
            transform: translateY(-4px);
            box-shadow: 0 40px 70px rgba(233, 30, 99, 0.26);
        }

        #display-image {
            width: clamp(160px, 40vw, 220px);
            border-radius: 15px;
            margin-bottom: 18px;
            box-shadow: 0 16px 30px rgba(233, 30, 99, 0.2);
            animation: floaty 4.5s ease-in-out infinite, glowPulse 4s ease-in-out infinite;
            transition: transform 0.35s ease, box-shadow 0.35s ease;
        }

        #display-image:hover {
            transform: translateY(-4px) scale(1.03);
            box-shadow: 0 20px 36px rgba(233, 30, 99, 0.28);
        }

        h1 {
            font-size: clamp(1.85rem, 4.8vw, 2.4rem);
            color: var(--text-dark);
            margin: 0 0 8px;
            text-shadow: 0 2px 6px rgba(233, 30, 99, 0.15);
        }

        .subtitle {
            font-size: clamp(0.98rem, 2.6vw, 1.05rem);
            color: #6d5d6f;
            margin: 0 0 20px;
        }

        .love-note {
            font-size: clamp(0.98rem, 2.6vw, 1.05rem);
            line-height: 1.55;
            background: linear-gradient(135deg, rgba(255, 245, 248, 0.95), rgba(255, 233, 245, 0.75));
            border-radius: 18px;
            padding: 16px 18px;
            margin: 14px 0 18px;
            border: 1px solid rgba(255, 255, 255, 0.9);
            box-shadow: inset 0 0 12px rgba(255, 255, 255, 0.7);
        }

        .day-highlight {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 18px;
            padding: 16px 18px;
            border: 1px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 10px 20px rgba(233, 30, 99, 0.12);
        }

        .day-label {
            margin: 0;
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #8a6e85;
        }

        #day-title {
            margin: 6px 0 8px;
            font-size: clamp(1.35rem, 3.6vw, 1.7rem);
            color: #b21856;
        }

        .day-message {
            margin: 0 0 10px;
            font-size: 1rem;
            color: #5f4a60;
        }

        .day-extra {
            margin: 10px 0 12px;
            padding: 12px 14px;
            background: linear-gradient(135deg, rgba(255, 238, 246, 0.8), rgba(255, 248, 252, 0.9));
            border-radius: 14px;
            color: #66465f;
            font-size: 0.98rem;
        }

        .day-extra ul {
            margin: 8px 0 0 18px;
            padding: 0;
        }

        .day-reminder {
            margin: 0;
            font-weight: 600;
            color: #9a4f74;
        }

        .season-note {
            margin: 10px 0 0;
            font-size: 0.95rem;
            color: #7b5b72;
            font-style: italic;
        }

        .day-pages {
            margin-top: 20px;
            text-align: left;
        }

        .content-tabs {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding-bottom: 6px;
            margin-bottom: 12px;
            scrollbar-width: thin;
        }

        .content-tab {
            border: 1px solid rgba(233, 30, 99, 0.2);
            background: #fff8fb;
            color: #7a3f5f;
            border-radius: 999px;
            padding: 6px 12px;
            font-size: 0.85rem;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .content-tab.active {
            background: linear-gradient(135deg, #ff8fbf, #d16bff);
            color: white;
            border-color: transparent;
            box-shadow: 0 8px 18px rgba(233, 30, 99, 0.25);
        }

        .page-content {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 18px;
            box-shadow: 0 12px 24px rgba(233, 30, 99, 0.12);
            border: 1px solid rgba(255, 255, 255, 0.8);
        }

        .page-content.animate {
            animation: fadeSlide 0.45s ease;
        }

        .page-title {
            margin: 0 0 10px;
            font-size: 1.15rem;
            color: #7a2e56;
        }

        .question-list {
            margin: 0 0 12px 18px;
            color: #5f4a60;
        }

        .choice-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 12px;
        }

        .choice-button {
            border: 1px solid rgba(233, 30, 99, 0.2);
            background: #fff4fb;
            color: #6b3a59;
            border-radius: 14px;
            padding: 10px 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            text-decoration: none;
        }

        a.choice-button {
            text-decoration: none;
        }

        .choice-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 18px rgba(233, 30, 99, 0.18);
        }

        .choice-button.selected {
            background: linear-gradient(135deg, #ff8fbf, #d16bff);
            color: #fff;
            border-color: transparent;
        }

        .love-letter {
            background: linear-gradient(135deg, rgba(255, 235, 245, 0.9), rgba(255, 250, 252, 0.95));
            border-radius: 16px;
            padding: 14px 16px;
            font-size: 0.98rem;
            color: #5c3f55;
            line-height: 1.5;
            box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.7);
        }

        .letter-card {
            display: flex;
            flex-direction: column;
            gap: 14px;
        }

        .letter-seal {
            border: none;
            border-radius: 18px;
            padding: 18px 20px;
            background: linear-gradient(135deg, rgba(255, 231, 245, 0.95), rgba(255, 247, 252, 0.98));
            box-shadow: 0 12px 26px rgba(233, 30, 99, 0.18);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative;
            text-align: center;
        }

        .letter-seal::before,
        .letter-seal::after {
            content: "";
            position: absolute;
            width: 70%;
            height: 2px;
            background: rgba(233, 30, 99, 0.18);
            border-radius: 999px;
        }

        .letter-seal::before {
            top: 18px;
        }

        .letter-seal::after {
            bottom: 18px;
        }

        .letter-seal:hover {
            transform: translateY(-2px);
            box-shadow: 0 16px 30px rgba(233, 30, 99, 0.22);
        }

        .letter-seal.opened {
            background: linear-gradient(135deg, rgba(255, 214, 234, 0.9), rgba(255, 246, 252, 0.95));
        }

        .letter-icon {
            font-size: 2.2rem;
        }

        .letter-title {
            font-weight: 600;
            color: #7a2e56;
            font-size: 1rem;
        }

        .letter-subtitle {
            font-size: 0.92rem;
            color: #7b5b72;
        }

        .page-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            color: #8a5c78;
            font-size: 0.9rem;
            gap: 10px;
        }

        .buttons {
            margin-top: 26px;
            display: flex;
            justify-content: center;
            gap: 20px;
            min-height: 50px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 30px;
            font-size: clamp(1.05rem, 3.5vw, 1.2rem);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.3s ease, letter-spacing 0.3s ease;
            font-weight: 600;
            min-width: 140px;
            min-height: 48px;
        }

        #yes-btn {
            background: linear-gradient(135deg, var(--pink-500), var(--purple-500), #ff7bbf);
            color: white;
            box-shadow: 0 16px 24px rgba(233, 30, 99, 0.35);
            position: relative;
            overflow: hidden;
            background-size: 200% 200%;
            animation: heartbeat 2.6s ease-in-out infinite, gradientShift 6s ease-in-out infinite;
        }

        #yes-btn::after {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(120deg, rgba(255, 255, 255, 0) 30%, rgba(255, 255, 255, 0.4) 50%, rgba(255, 255, 255, 0) 70%);
            transform: translateX(-120%);
            transition: transform 0.6s ease;
        }

        #no-btn {
            background-color: #fff7fb;
            color: #5a425f;
            box-shadow: 0 10px 18px rgba(0,0,0,0.12);
        }

        #yes-btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 20px 32px rgba(233, 30, 99, 0.4);
            letter-spacing: 0.5px;
        }

        #yes-btn:hover::after {
            transform: translateX(120%);
        }

        #no-btn:hover {
            transform: translateY(-2px);
            animation: wiggle 0.4s ease-in-out;
        }

        button:active {
            transform: translateY(1px) scale(0.98);
        }

        .signature {
            margin-top: 24px;
            font-size: 1rem;
            color: #6d5d6f;
        }

        /* Success Message Styling */
        .success-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: fadeIn 0.5s ease-in;
        }

        .success-content p {
            font-size: 1.5rem;
            margin: 10px 0;
        }

        .success-content img {
            width: min(250px, 80vw);
            height: auto;
            max-width: 100%;
        }

        .success-content .final-note {
            font-size: 1.05rem;
            margin-top: 6px;
        }

        @media (max-width: 600px) {
            body {
                align-items: flex-start;
                padding: 20px 12px 32px;
            }

            .container {
                width: 100%;
                padding: 28px 20px;
                border-radius: 22px;
            }

            #display-image {
                width: min(70vw, 220px);
            }

            .choice-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .page-footer {
                flex-wrap: wrap;
                justify-content: center;
                text-align: center;
            }

            .content-tabs {
                -webkit-overflow-scrolling: touch;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 16px 10px 28px;
            }

            .container {
                padding: 24px 16px;
                border-radius: 20px;
            }

            .buttons {
                flex-direction: column;
                align-items: stretch;
                gap: 12px;
            }

            button {
                width: 100%;
                min-width: 0;
            }

            .choice-grid {
                grid-template-columns: 1fr;
            }

            .content-tabs {
                gap: 6px;
            }

            .content-tab {
                padding: 6px 10px;
                font-size: 0.8rem;
            }

            .day-pages {
                margin-top: 16px;
            }

            .page-content {
                padding: 16px;
            }

            .letter-seal {
                padding: 16px 18px;
            }
        }

        .success-title {
            margin: 0 0 8px;
            font-size: clamp(1.6rem, 4.2vw, 2.2rem);
            color: #b21856;
        }

        .success-subtitle {
            margin: 0 0 16px;
            font-size: 1.05rem;
            color: #6b3a59;
        }

        .success-message {
            font-size: 1.05rem;
            line-height: 1.55;
            color: #5c3f55;
            background: linear-gradient(135deg, rgba(255, 245, 250, 0.95), rgba(255, 233, 247, 0.85));
            border-radius: 16px;
            padding: 14px 16px;
            margin-bottom: 16px;
            box-shadow: inset 0 0 12px rgba(255, 255, 255, 0.7);
        }

        .success-questions {
            text-align: left;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            padding: 14px 16px;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 10px 20px rgba(233, 30, 99, 0.12);
            margin-bottom: 16px;
        }

        .success-questions h3,
        .success-letters h3 {
            margin: 0 0 10px;
            font-size: 1.1rem;
            color: #7a2e56;
        }

        .success-letters {
            text-align: left;
            background: rgba(255, 255, 255, 0.92);
            border-radius: 16px;
            padding: 14px 16px;
            border: 1px solid rgba(255, 255, 255, 0.85);
            box-shadow: 0 10px 20px rgba(233, 30, 99, 0.12);
        }

        .success-letters ul,
        .success-questions ul {
            margin: 0;
            padding-left: 18px;
            color: #5f4a60;
        }

        .success-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 16px;
        }

        .success-actions .choice-button {
            padding: 10px 18px;
        }

        .mcq-item {
            background: rgba(255, 255, 255, 0.92);
            border-radius: 16px;
            padding: 14px 16px;
            border: 1px solid rgba(233, 30, 99, 0.12);
            box-shadow: 0 10px 20px rgba(233, 30, 99, 0.08);
            margin-bottom: 12px;
        }

        .mcq-question {
            margin: 0 0 10px;
            font-weight: 600;
            color: #7a2e56;
        }

        .mcq-quote {
            margin: 8px 0 0;
            padding: 10px 12px;
            border-radius: 12px;
            background: linear-gradient(135deg, rgba(255, 239, 248, 0.95), rgba(255, 247, 252, 0.95));
            color: #5c3f55;
            font-style: italic;
            box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.7);
        }

        .loading-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            padding: 12px 0;
            animation: fadeIn 0.6s ease;
        }

        .initial-loading-overlay {
            position: fixed;
            inset: 0;
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
            background: radial-gradient(circle at top, rgba(255, 246, 251, 0.97) 0%, rgba(253, 233, 255, 0.95) 32%, rgba(255, 214, 234, 0.92) 68%, rgba(255, 202, 222, 0.9) 100%);
            backdrop-filter: blur(6px);
        }

        .loading-title {
            margin: 0;
            font-size: clamp(1.5rem, 4vw, 2rem);
            color: #b21856;
        }

        .loading-icon {
            font-size: clamp(2.2rem, 6vw, 3rem);
        }

        .loading-heart {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-size: clamp(2.2rem, 6vw, 3rem);
            animation: heartbeat 1.6s ease-in-out infinite;
        }

        .loading-subtitle {
            margin: 0;
            font-size: 1rem;
            color: #6b3a59;
        }

        .loading-theme {
            margin: 0;
            font-size: 0.95rem;
            color: #8a5c78;
            font-weight: 600;
            letter-spacing: 0.3px;
        }

        .petal-field {
            position: relative;
            width: min(260px, 80vw);
            height: 140px;
            margin-top: 6px;
            overflow: hidden;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(255, 240, 247, 0.95), rgba(255, 214, 234, 0.85));
            box-shadow: inset 0 0 12px rgba(255, 255, 255, 0.7);
        }

        .petal {
            position: absolute;
            top: -20px;
            font-size: 1.2rem;
            opacity: 0;
            animation-name: petalFall;
            animation-duration: var(--fall-duration, 2.8s);
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            animation-fill-mode: both;
        }

        .rose-display {
            display: grid;
            place-items: center;
            gap: 10px;
            margin-top: 4px;
        }

        .rose-loader-stage {
            position: relative;
            width: min(240px, 78vw);
            height: 130px;
            border-radius: 18px;
            background: linear-gradient(145deg, rgba(255, 238, 246, 0.95), rgba(255, 207, 226, 0.85));
            box-shadow: inset 0 0 14px rgba(255, 255, 255, 0.75);
            overflow: hidden;
        }

        .rose-heart-particle {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.1rem;
            opacity: 0;
            animation: roseAssemble 2.6s ease-in-out infinite;
            animation-delay: var(--delay, 0s);
        }

        .teddy-display {
            display: grid;
            place-items: center;
            gap: 10px;
            margin-top: 4px;
        }

        .teddy-loader {
            display: grid;
            place-items: center;
            width: 116px;
            height: 116px;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.94), rgba(255, 217, 235, 0.85));
            box-shadow: 0 16px 28px rgba(233, 30, 99, 0.14);
        }

        .teddy-bounce {
            font-size: 3rem;
            animation: teddyBounce 1.05s cubic-bezier(0.4, 0, 0.2, 1) infinite;
            transform-origin: center bottom;
        }

        .teddy-shadow {
            width: 52px;
            height: 12px;
            border-radius: 999px;
            background: rgba(122, 46, 86, 0.2);
            filter: blur(1px);
            animation: teddyShadow 1.05s ease-in-out infinite;
        }

        .promise-display {
            display: grid;
            place-items: center;
            gap: 10px;
            margin-top: 4px;
        }

        .promise-loader-stage {
            position: relative;
            width: min(240px, 78vw);
            height: 140px;
            border-radius: 18px;
            background: radial-gradient(circle at top, rgba(255, 255, 255, 0.96), rgba(255, 214, 234, 0.88));
            box-shadow: inset 0 0 14px rgba(255, 255, 255, 0.75);
            overflow: hidden;
        }

        .promise-loader-stage .petal-field {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            margin-top: 0;
            border-radius: 0;
            background: transparent;
            box-shadow: none;
            pointer-events: none;
            z-index: 1;
        }

        .promise-loader-canvas {
            position: relative;
            z-index: 2;
            width: 100%;
            height: 100%;
            display: block;
        }

        .promise-symbols {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 3;
        }

        .promise-symbol {
            position: absolute;
            display: grid;
            place-items: center;
            text-shadow: 0 3px 8px rgba(255, 255, 255, 0.6);
        }

        .promise-symbol.teddy {
            left: 18%;
            bottom: 18px;
            font-size: 2.15rem;
            animation: teddyBounce 1.05s cubic-bezier(0.4, 0, 0.2, 1) infinite;
        }

        .promise-symbol.flower {
            right: 20%;
            bottom: 30px;
            font-size: 1.6rem;
            animation: promisePulse 1.7s ease-in-out infinite;
            animation-delay: 0.2s;
        }

        .promise-symbol.heart {
            right: 34%;
            top: 20px;
            font-size: 1.55rem;
            animation: promisePulse 1.5s ease-in-out infinite;
            animation-delay: 0.5s;
        }

        .rose-bloom {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 6px;
            font-size: 1.6rem;
        }

        .rose-stem {
            font-size: 1.4rem;
        }

        .proposal-display,
        .hug-display,
        .kiss-display,
        .valentine-display {
            display: grid;
            place-items: center;
            gap: 10px;
            margin-top: 4px;
        }

        .proposal-ring {
            display: grid;
            place-items: center;
            width: 80px;
            height: 80px;
            border-radius: 999px;
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.95), rgba(255, 214, 234, 0.9));
            border: 2px solid rgba(255, 143, 191, 0.6);
            box-shadow: 0 12px 20px rgba(233, 30, 99, 0.18);
            font-size: 1.8rem;
        }

        .proposal-sparkles {
            display: flex;
            gap: 6px;
            font-size: 1.2rem;
        }

        .hug-cloud {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.85);
            box-shadow: 0 10px 18px rgba(233, 30, 99, 0.12);
            font-size: 1.4rem;
        }

        .hug-hearts,
        .kiss-sparkles,
        .valentine-fireworks {
            display: flex;
            gap: 6px;
            font-size: 1.2rem;
        }

        .kiss-lips {
            font-size: 2rem;
            letter-spacing: 6px;
        }

        .valentine-heart {
            font-size: 2rem;
        }

        .floating-hearts {
            position: absolute;
            inset: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 0;
        }

        .burst-heart {
            position: absolute;
            font-size: 22px;
            opacity: 0;
            animation: burst 1.2s ease-out forwards;
            pointer-events: none;
        }

        .floating-hearts span {
            position: absolute;
            bottom: -50px;
            font-size: 18px;
            opacity: 0.7;
            animation: heartsUp 10s linear infinite;
        }

        .floating-hearts span:nth-child(2) { left: 15%; animation-delay: 1s; font-size: 22px; }
        .floating-hearts span:nth-child(3) { left: 30%; animation-delay: 3s; font-size: 16px; }
        .floating-hearts span:nth-child(4) { left: 45%; animation-delay: 2s; font-size: 20px; }
        .floating-hearts span:nth-child(5) { left: 60%; animation-delay: 4s; font-size: 24px; }
        .floating-hearts span:nth-child(6) { left: 75%; animation-delay: 1.5s; font-size: 18px; }
        .floating-hearts span:nth-child(7) { left: 85%; animation-delay: 2.7s; font-size: 20px; }

        @keyframes floaty {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-12px); }
        }

        @keyframes softFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-6px); }
        }

        @keyframes cardRise {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes heartsUp {
            0% { transform: translateY(0) scale(1); opacity: 0; }
            20% { opacity: 0.8; }
            100% { transform: translateY(-120vh) scale(1.2); opacity: 0; }
        }

        @keyframes floatGlow {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(25px); }
        }

        @keyframes borderGlow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.9; }
        }

        @keyframes wiggle {
            0% { transform: translateY(-2px) rotate(0deg); }
            25% { transform: translateY(-2px) rotate(2deg); }
            50% { transform: translateY(-2px) rotate(-2deg); }
            75% { transform: translateY(-2px) rotate(1deg); }
            100% { transform: translateY(-2px) rotate(0deg); }
        }

        @keyframes heartbeat {
            0%, 100% { transform: translateY(0) scale(1); }
            40% { transform: translateY(-2px) scale(1.03); }
            70% { transform: translateY(0) scale(0.98); }
        }

        @keyframes glowPulse {
            0%, 100% { box-shadow: 0 16px 30px rgba(233, 30, 99, 0.2); }
            50% { box-shadow: 0 20px 36px rgba(233, 30, 99, 0.28); }
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes burst {
            0% { transform: translate(0, 0) scale(0.5); opacity: 0; }
            30% { opacity: 1; }
            100% { transform: translate(var(--x, 0), var(--y, -80px)) scale(1.2); opacity: 0; }
        }

        @keyframes fadeSlide {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes petalFall {
            0% { transform: translateY(0) rotate(0deg) scale(0.9); opacity: 0; }
            20% { opacity: 0.9; }
            100% { transform: translateY(160px) rotate(120deg) scale(1.1); opacity: 0; }
        }

        @keyframes roseAssemble {
            0% {
                opacity: 0;
                transform: translate(calc(-50% + var(--sx, 0px)), calc(-50% + var(--sy, 0px))) scale(0.5);
            }
            35% {
                opacity: 0.95;
            }
            60%,
            100% {
                opacity: 0.85;
                transform: translate(calc(-50% + var(--tx, 0px)), calc(-50% + var(--ty, 0px))) scale(1);
            }
        }

        @keyframes teddyBounce {
            0%, 100% { transform: translateY(0) scale(1); }
            45% { transform: translateY(-18px) scale(1.05); }
            70% { transform: translateY(-6px) scale(0.98); }
        }

        @keyframes teddyShadow {
            0%, 100% { transform: scaleX(1); opacity: 0.24; }
            45% { transform: scaleX(0.7); opacity: 0.14; }
            70% { transform: scaleX(0.86); opacity: 0.18; }
        }

        @keyframes promisePulse {
            0%, 100% { transform: translateY(0) scale(1); opacity: 0.78; }
            50% { transform: translateY(-6px) scale(1.12); opacity: 1; }
        }

        @media (max-width: 600px) {
            body {
                padding: 24px 12px 32px;
            }

            .container {
                padding: 28px 22px;
                border-radius: 22px;
            }

            .buttons {
                flex-direction: column;
                gap: 12px;
            }

            button {
                width: 100%;
            }

            .content-tabs {
                justify-content: flex-start;
            }
        }

        @media (max-height: 700px) {
            .container {
                padding: 24px 20px;
            }

            .love-note {
                padding: 14px 16px;
            }
        }

        @media (hover: none) {
            #yes-btn:hover,
            #no-btn:hover,
            #display-image:hover,
            .container:hover {
                transform: none;
                animation: none;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-XYE89XRTTM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XYE89XRTTM', {
    anonymize_ip: true
  });
</script>
</head>
<body>
    <div class="floating-hearts" aria-hidden="true">
        <span style="left: 5%;">üíó</span>
        <span>üíñ</span>
        <span>üíû</span>
        <span>üíò</span>
        <span>üíì</span>
        <span>üíù</span>
        <span>üíï</span>
    </div>
    <main class="container-fluid px-3 px-md-4 py-3 py-md-4">
        <div class="row justify-content-center">
            <div class="col-12 col-md-10 col-lg-8 col-xl-6 d-flex justify-content-center">
                <div class="container" id="main-card">
                    <div id="content-wrapper">
                        <img id="display-image" src="data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%27http%3A//www.w3.org/2000/svg%27%20width%3D%27320%27%20height%3D%27240%27%20viewBox%3D%270%200%20320%20240%27%3E%3Crect%20width%3D%27320%27%20height%3D%27240%27%20rx%3D%2724%27%20fill%3D%27%23ffe6ef%27/%3E%3Ctext%20x%3D%2750%25%27%20y%3D%2755%25%27%20text-anchor%3D%27middle%27%20font-size%3D%2756%27%3E%F0%9F%92%96%3C/text%3E%3C/svg%3E" alt="Today's love scene">
                        <h1 id="question">Sindhu, will you be my Valentine?</h1>
                        <p class="subtitle">A soft moment, a brave question, and a forever kind of yes.</p>
                        <div class="love-note">
                            You make everything feel lighter, sweeter, and brighter. I‚Äôd love to spend this Valentine‚Äôs Day
                            laughing, cuddling, and making new memories that feel like home.
                        </div>
                        <div class="day-highlight">
                            <p class="day-label" id="day-label">Today is</p>
                            <h2 id="day-title">Rose Day üåπ</h2>
                            <p class="day-message" id="day-message">
                                Let me shower you with roses and remind you how wildly beautiful love can be.
                            </p>
                            <div class="day-extra" id="day-extra"></div>
                            <p class="day-reminder" id="day-reminder">Come back tomorrow for a brand-new love surprise. üíû</p>
                            <p class="season-note" id="season-note" hidden></p>
                        </div>
                        <div class="day-pages">
                            <div class="content-tabs" id="content-tabs" aria-label="Today's love tabs"></div>
                            <div class="page-content" id="page-content">
                                <h3 class="page-title" id="page-title">Rose Day Love Page</h3>
                                <div id="page-body"></div>
                                <div class="page-footer">
                                    <span id="page-count">Today‚Äôs page</span>
                                    <span id="today-badge">Today‚Äôs pick üíñ</span>
                                </div>
                            </div>
                        </div>
                        <div class="buttons d-flex flex-column flex-sm-row align-items-stretch align-items-sm-center" id="button-group">
                            <button id="yes-btn">Yes</button>
                            <button id="no-btn">No</button>
                        </div>
                        <p class="signature">
                            With love, <strong>Chandu ‚ù§Ô∏è</strong>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        const noBtn = document.getElementById('no-btn');
        const yesBtn = document.getElementById('yes-btn');
        const container = document.getElementById('content-wrapper');
        const dayLabel = document.getElementById('day-label');
        const dayTitle = document.getElementById('day-title');
        const dayMessage = document.getElementById('day-message');
        const dayExtra = document.getElementById('day-extra');
        const dayReminder = document.getElementById('day-reminder');
        const seasonNote = document.getElementById('season-note');
        const contentTabs = document.getElementById('content-tabs');
        const pageContent = document.getElementById('page-content');
        const pageTitle = document.getElementById('page-title');
        const pageBody = document.getElementById('page-body');
        const pageCount = document.getElementById('page-count');
        const todayBadge = document.getElementById('today-badge');
        const noMessages = [
            'I miss you.',
            'I like you.',
            'I adore you.',
            'I‚Äôm thinking of you.',
            'You mean the world to me.'
        ];

        const GA_TRACKING_ID = 'G-XYE89XRTTM';
        const analyticsEnabled = typeof window.gtag === 'function';

        const safeStorage = {
            get: (key) => {
                try {
                    return localStorage.getItem(key);
                } catch {
                    return null;
                }
            },
            set: (key, value) => {
                try {
                    localStorage.setItem(key, value);
                } catch {
                    // Ignore storage errors (private mode / blocked storage).
                }
            }
        };

        const getOrCreateId = (key) => {
            const existing = safeStorage.get(key);
            if (existing) {
                return existing;
            }
            const created = `${Date.now()}-${Math.random().toString(36).slice(2, 10)}`;
            safeStorage.set(key, created);
            return created;
        };

        const visitorId = getOrCreateId('valentine_visitor_id');
        const sessionId = `${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;
        const previousVisitCount = Number(safeStorage.get('valentine_visit_count') || '0');
        const visitCount = previousVisitCount + 1;
        safeStorage.set('valentine_visit_count', String(visitCount));

        const trackEvent = (eventName, params = {}) => {
            if (!analyticsEnabled) {
                return;
            }
            gtag('event', eventName, {
                page_title: document.title,
                page_path: window.location.pathname,
                ...params
            });
        };

        const setUserProperties = () => {
            if (!analyticsEnabled) {
                return;
            }

            gtag('config', GA_TRACKING_ID, {
                user_id: visitorId,
                user_properties: {
                    visit_count: visitCount,
                    language: navigator.language || 'unknown',
                    viewport: `${window.innerWidth}x${window.innerHeight}`,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone || 'unknown'
                }
            });
        };

        const sectionTiming = {
            currentSection: null,
            sectionStart: 0,
            currentTab: null,
            tabStart: 0
        };

        const startSectionTimer = (sectionName) => {
            const now = performance.now();

            if (sectionTiming.currentSection) {
                const durationMs = Math.round(now - sectionTiming.sectionStart);
                trackEvent('section_time_spent', {
                    section_name: sectionTiming.currentSection,
                    duration_ms: durationMs,
                    duration_seconds: Number((durationMs / 1000).toFixed(2))
                });
            }

            sectionTiming.currentSection = sectionName;
            sectionTiming.sectionStart = now;
        };

        const startTabTimer = (tabName) => {
            const now = performance.now();

            if (sectionTiming.currentTab) {
                const durationMs = Math.round(now - sectionTiming.tabStart);
                trackEvent('tab_time_spent', {
                    tab_name: sectionTiming.currentTab,
                    duration_ms: durationMs,
                    duration_seconds: Number((durationMs / 1000).toFixed(2))
                });
            }

            sectionTiming.currentTab = tabName;
            sectionTiming.tabStart = now;
        };

        setUserProperties();
        trackEvent('experience_opened', {
            visitor_id: visitorId,
            session_id: sessionId,
            visit_count: visitCount,
            referrer: document.referrer || 'direct'
        });

        const bgmTracks = [
            'assets/ManasanthaNuvve.mp3',
            'assets/Manmadhudu.mp3',
            'assets/Sontham.mp3'
        ];

        const randomBgmTrack = bgmTracks[Math.floor(Math.random() * bgmTracks.length)];
        trackEvent('bgm_selected', { track_name: randomBgmTrack });

        const bgmPlayer = new Audio(randomBgmTrack);
        bgmPlayer.loop = true;
        bgmPlayer.preload = 'auto';
        const defaultBgmVolume = 0.35;
        const speakingBgmVolume = 0.18;
        bgmPlayer.volume = defaultBgmVolume;
        let hasStartedBgm = false;

        const startBgmAfterYes = async () => {
            if (hasStartedBgm) {
                return;
            }

            try {
                await bgmPlayer.play();
                hasStartedBgm = true;
                trackEvent('bgm_started_after_yes', { track_name: randomBgmTrack });
            } catch {
                trackEvent('bgm_start_failed_after_yes', { track_name: randomBgmTrack });
            }
        };

        const speakMessage = (message) => {
            if (!('speechSynthesis' in window)) {
                return;
            }
            const utterance = new SpeechSynthesisUtterance(message);
            utterance.pitch = 1.6;
            utterance.rate = 0.95;
            utterance.volume = 1;
            utterance.onstart = () => {
                bgmPlayer.volume = speakingBgmVolume;
            };
            utterance.onend = () => {
                bgmPlayer.volume = defaultBgmVolume;
            };
            utterance.onerror = () => {
                bgmPlayer.volume = defaultBgmVolume;
            };
            speechSynthesis.cancel();
            speechSynthesis.speak(utterance);
        };

        const createFallbackImage = (label) => {
            const safeLabel = label || 'Love note';
            const svg = `
                <svg xmlns="http://www.w3.org/2000/svg" width="320" height="240" viewBox="0 0 320 240">
                    <defs>
                        <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
                            <stop offset="0%" stop-color="#ffe6ef"/>
                            <stop offset="100%" stop-color="#ffd1f0"/>
                        </linearGradient>
                    </defs>
                    <rect width="320" height="240" rx="24" fill="url(#bg)"/>
                    <text x="50%" y="46%" text-anchor="middle" font-size="56">üíñ</text>
                    <text x="50%" y="66%" text-anchor="middle" font-family="Poppins, Arial, sans-serif" font-size="16" fill="#b21856">
                        ${safeLabel}
                    </text>
                    <text x="50%" y="78%" text-anchor="middle" font-family="Poppins, Arial, sans-serif" font-size="12" fill="#6b3a59">
                        Image unavailable
                    </text>
                </svg>
            `;

            return `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;
        };

        const createDecorativeImage = (emoji, label, accent = '#ff9cc6') => {
            const safeLabel = label || 'Love note';
            const safeEmoji = emoji || 'üíñ';
            const svg = `
                <svg xmlns="http://www.w3.org/2000/svg" width="320" height="240" viewBox="0 0 320 240">
                    <defs>
                        <linearGradient id="bg" x1="0" y1="0" x2="1" y2="1">
                            <stop offset="0%" stop-color="#fff1f7"/>
                            <stop offset="100%" stop-color="${accent}"/>
                        </linearGradient>
                    </defs>
                    <rect width="320" height="240" rx="24" fill="url(#bg)"/>
                    <circle cx="80" cy="60" r="24" fill="rgba(255,255,255,0.6)"/>
                    <circle cx="250" cy="80" r="18" fill="rgba(255,255,255,0.4)"/>
                    <text x="50%" y="48%" text-anchor="middle" font-size="56">${safeEmoji}</text>
                    <text x="50%" y="68%" text-anchor="middle" font-family="Poppins, Arial, sans-serif" font-size="16" fill="#7a2e56">
                        ${safeLabel}
                    </text>
                    <text x="50%" y="80%" text-anchor="middle" font-family="Poppins, Arial, sans-serif" font-size="12" fill="#6b3a59">
                        Love note preview
                    </text>
                </svg>
            `;

            return `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;
        };

        const createValentinePenguinImage = (label = 'Be my Valentine?') => {
            const safeLabel = label || 'Be my Valentine?';
            const svg = `
                <svg xmlns="http://www.w3.org/2000/svg" width="360" height="260" viewBox="0 0 360 260">
                    <defs>
                        <linearGradient id="bed" x1="0" y1="0" x2="1" y2="1">
                            <stop offset="0%" stop-color="#ffd1e8"/>
                            <stop offset="100%" stop-color="#ffb3d5"/>
                        </linearGradient>
                        <linearGradient id="wall" x1="0" y1="0" x2="1" y2="1">
                            <stop offset="0%" stop-color="#fff6fb"/>
                            <stop offset="100%" stop-color="#fde2f0"/>
                        </linearGradient>
                        <linearGradient id="penguin" x1="0" y1="0" x2="1" y2="1">
                            <stop offset="0%" stop-color="#8fb6ff"/>
                            <stop offset="100%" stop-color="#6d93ff"/>
                        </linearGradient>
                    </defs>
                    <rect width="360" height="260" rx="28" fill="url(#wall)"/>
                    <rect x="18" y="110" width="324" height="120" rx="26" fill="url(#bed)"/>
                    <rect x="30" y="84" width="200" height="60" rx="24" fill="#ffdbe9"/>
                    <rect x="214" y="70" width="110" height="100" rx="26" fill="#f7b9d6"/>
                    <rect x="214" y="70" width="110" height="100" rx="26" fill="url(#bed)" opacity="0.6"/>
                    <rect x="250" y="108" width="30" height="50" rx="10" fill="#fff4fb" opacity="0.6"/>

                    <ellipse cx="150" cy="185" rx="72" ry="52" fill="url(#penguin)"/>
                    <ellipse cx="150" cy="180" rx="48" ry="38" fill="#fff9f2"/>
                    <ellipse cx="115" cy="200" rx="18" ry="26" fill="#86a9ff"/>
                    <ellipse cx="185" cy="200" rx="18" ry="26" fill="#86a9ff"/>
                    <polygon points="150,170 165,178 150,186 135,178" fill="#f6b146"/>
                    <circle cx="140" cy="162" r="6" fill="#2d2a32"/>
                    <circle cx="160" cy="162" r="6" fill="#2d2a32"/>
                    <circle cx="138" cy="160" r="2" fill="#fff"/>
                    <circle cx="158" cy="160" r="2" fill="#fff"/>

                    <path d="M70 70c8-10 18-10 26 0c-8 10-18 10-26 0z" fill="#ff7ab8"/>
                    <path d="M110 50c8-10 18-10 26 0c-8 10-18 10-26 0z" fill="#ff6fae"/>
                    <path d="M250 44c8-10 18-10 26 0c-8 10-18 10-26 0z" fill="#ff6fae"/>
                    <path d="M290 88c8-10 18-10 26 0c-8 10-18 10-26 0z" fill="#ff8fbf"/>
                    <path d="M82 110c8-10 18-10 26 0c-8 10-18 10-26 0z" fill="#ff8fbf"/>

                    <text x="50%" y="248" text-anchor="middle" font-family="Poppins, Arial, sans-serif" font-size="16" fill="#7a2e56">
                        ${safeLabel}
                    </text>
                </svg>
            `;

            return `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;
        };

        const setImageWithFallback = (imageEl, src, altText, label) => {
            if (!imageEl) {
                return;
            }

            imageEl.alt = altText || label || 'Love note image';
            imageEl.src = src;
            imageEl.onerror = () => {
                imageEl.onerror = null;
                imageEl.src = createFallbackImage(label);
            };
        };

        const valentineWeek = [
            {
                month: 1,
                day: 7,
                title: 'Rose Day üåπ',
                image: {
                    src: createDecorativeImage('üåπ', 'Rose Day', '#ffb3c7'),
                    alt: 'A bouquet of roses glowing with love'
                },
                successImage: {
                    src: createDecorativeImage('üå∑', 'Rose Day Celebration', '#ff8fbf'),
                    alt: 'A rose-filled celebration for a sweet yes'
                },
                loading: {
                    title: 'Preparing your rose surprise...',
                    icon: 'üåπüíûüåπ',
                    petals: 'üåπ'
                },
                message: 'A single rose can say ‚ÄúI adore you,‚Äù but I want to give you a whole garden of care.',
                proposal: 'Will you let me fill your days with little blooms of love?',
                questions: [
                    'Which color rose matches your mood today?',
                    'Can I surprise you with a tiny bouquet and a big hug?',
                    'Will you accept a rose and my heart with it?'
                ],
                mcq: [
                    {
                        prompt: 'What kind of rose surprise would make you smile first?',
                        options: [
                            { label: 'A single rose with a note üíå', quote: 'Simple, sincere, and straight from my heart to yours.' },
                            { label: 'A mini bouquet after class/work üåπ', quote: 'A little bloom to say: I missed you all day.' },
                            { label: 'Roses hidden around the room ‚ú®', quote: 'A tiny treasure hunt where every flower says ‚ÄúI adore you.‚Äù' },
                            { label: 'A rose plus your favorite snack üç´', quote: 'Because love should always come with sweet extras.' }
                        ]
                    },
                    {
                        prompt: 'Which rose vibe feels most like us?',
                        options: [
                            { label: 'Soft and classic ‚ù§Ô∏è', quote: 'Timeless love, gentle moments, and warm forever feelings.' },
                            { label: 'Playful and bright üåº', quote: 'Lots of laughter, teasing smiles, and happy little chaos.' },
                            { label: 'Dreamy and poetic üåô', quote: 'Late-night talks, starlit wishes, and love that lingers.' },
                            { label: 'A little bit of everything üíñ', quote: 'Perfect‚Äîour story gets to be beautifully us in every way.' }
                        ]
                    }
                ],
                choices: [
                    'Blush pink roses',
                    'Sunny yellow roses',
                    'Classic red roses',
                    'A single white rose'
                ],
                letters: [
                    'Every petal feels like a soft thank you for the way you light up my days. If I could, I‚Äôd leave a rose on your pillow every morning and a kiss on your forehead every night.',
                    'I want our love to bloom gently, like a garden that grows brighter each day. You‚Äôre my favorite flower in every season.'
                ]
            },
            {
                month: 1,
                day: 8,
                title: 'Propose Day üíç',
                image: {
                    src: createDecorativeImage('üíç', 'Propose Day', '#f0b1ff'),
                    alt: 'A sparkling ring for a sweet proposal'
                },
                successImage: {
                    src: createDecorativeImage('‚ú®', 'Propose Day Yes', '#d9a6ff'),
                    alt: 'A sparkling yes moment with hearts'
                },
                loading: {
                    title: 'Setting up your forever question...',
                    icon: 'üíçüíñüíç',
                    petals: '‚ú®'
                },
                message: 'Today I‚Äôm brave enough to ask the sweetest question of all.',
                proposal: 'Will you be my forever yes, my favorite hello, and my best love story?',
                questions: [
                    'Can we turn every ‚Äúsomeday‚Äù into ‚Äúus‚Äù?',
                    'Will you say yes to slow dances, shared dreams, and silly smiles?',
                    'May I be the one who always chooses you?'
                ],
                mcq: [
                    {
                        prompt: 'How should I pop the question?',
                        options: [
                            { label: 'Under fairy lights ‚ú®', quote: 'A soft glow, a steady heartbeat, and the simplest question: will you be mine?' },
                            { label: 'Over a handwritten note üíå', quote: 'Every word would hold the promise of forever, tucked gently between the lines.' },
                            { label: 'During a sunset walk üåÖ', quote: 'When the sky blushes, I‚Äôd ask you to stay and shine with me always.' },
                            { label: 'With a cozy at-home surprise üïØÔ∏è', quote: 'Just us, our favorite song, and a forever yes whispered softly.' }
                        ]
                    },
                    {
                        prompt: 'What kind of forever do you want us to build?',
                        options: [
                            { label: 'Playful and adventurous üé¢', quote: 'I promise a life full of laughter, road trips, and new stories.' },
                            { label: 'Calm and cozy üß∏', quote: 'Let‚Äôs make a home where peace lives and love always feels safe.' },
                            { label: 'Romantic and dreamy üí´', quote: 'I‚Äôll keep choosing you in every sunrise and every starlit night.' },
                            { label: 'All of the above üíñ', quote: 'Then I‚Äôll give you every version of forever, all wrapped in love.' }
                        ]
                    }
                ],
                choices: [
                    'A sunset walk proposal',
                    'A cozy candlelit question',
                    'A note tucked in a book',
                    'A promise whispered softly'
                ],
                letters: [
                    'I‚Äôm not asking for perfection, just a lifetime of real love. The kind that shows up, holds on, and keeps choosing each other every day.',
                    'I want to build a life where we celebrate little wins, hold each other on hard days, and never stop being best friends.'
                ]
            },
            {
                month: 1,
                day: 9,
                title: 'Chocolate Day üç´',
                image: {
                    src: createDecorativeImage('üç´', 'Chocolate Day', '#ffc4dd'),
                    alt: 'Delicious chocolates for a sweet day'
                },
                successImage: {
                    src: createDecorativeImage('üç¨', 'Chocolate Day Celebration', '#ffb3d5'),
                    alt: 'Chocolate treats raining down in celebration'
                },
                loading: {
                    title: 'Unwrapping your sweet surprise...',
                    icon: 'üç´üíûüç´',
                    petals: 'üç´'
                },
                message: 'Life is sweeter with you, so let‚Äôs share every bite and every laugh.',
                proposal: 'Can I be the one who brings your favorite treats and warm hugs?',
                questions: [
                    'Which chocolate should we share first: dark, milk, or all of them?',
                    'Can I be the sweet surprise in your day?',
                    'Will you save the last bite for me?'
                ],
                mcq: [
                    {
                        prompt: 'Pick our chocolate date style:',
                        options: [
                            { label: 'Movie + blanket + truffles üé¨', quote: 'A cozy night, your hand in mine, and sweet bites between scenes.' },
                            { label: 'Cafe dessert run ‚òï', quote: 'Two spoons, one table, and endless smiling over chocolate crumbs.' },
                            { label: 'Homemade brownie evening üßÅ', quote: 'Messy aprons, warm oven air, and kisses stolen in the kitchen.' },
                            { label: 'Surprise gift box at your door üéÅ', quote: 'A sweet reminder that I‚Äôm always thinking of you.' }
                        ]
                    },
                    {
                        prompt: 'How should I deliver your sweet treat?',
                        options: [
                            { label: 'With a handwritten tag üìù', quote: 'Each bite comes with a tiny ‚ÄúI love you.‚Äù' },
                            { label: 'With a voice note confession üéôÔ∏è', quote: 'So you can hear my smile while unwrapping it.' },
                            { label: 'With a surprise hug ü§ó', quote: 'Chocolate melts fast, but my affection won‚Äôt.' },
                            { label: 'With all three üíû', quote: 'Then it‚Äôs settled: maximum sweetness, maximum love.' }
                        ]
                    }
                ],
                choices: [
                    'Caramel truffle',
                    'Hazelnut praline',
                    'Dark chocolate sea salt',
                    'Strawberry cream'
                ],
                letters: [
                    'Love feels like melting chocolate on a rainy afternoon‚Äîwarm, sweet, and wrapped in comfort. I want to be that for you.',
                    'Let‚Äôs make every day a little sweeter, with shared treats, soft laughter, and all the joy in between.'
                ]
            },
            {
                month: 1,
                day: 10,
                title: 'Teddy Day üß∏',
                image: {
                    src: createDecorativeImage('üß∏', 'Teddy Day', '#ffd1e8'),
                    alt: 'A cuddly teddy bear waving hello'
                },
                successImage: {
                    src: createDecorativeImage('ü§ó', 'Teddy Day Hug', '#ffc8e0'),
                    alt: 'A bear hug celebration'
                },
                loading: {
                    title: 'Fluffing your teddy cuddles...',
                    icon: 'üß∏üíùüß∏',
                    petals: 'üíó'
                },
                message: 'Here‚Äôs a teddy bear to remind you you‚Äôre always safe and adored.',
                proposal: 'Will you be my cozy cuddle buddy for every season of love?',
                questions: [
                    'Should our teddy be named Snuggle or Honey?',
                    'Can I be your safe place after a long day?',
                    'Will you let me keep you wrapped in warmth?'
                ],
                mcq: [
                    {
                        prompt: 'What should our teddy carry for you?',
                        options: [
                            { label: 'A tiny ‚Äúmiss you‚Äù card üíå', quote: 'A soft reminder that you‚Äôre always on my mind.' },
                            { label: 'A little heart charm üíó', quote: 'So you can keep a piece of my love with you all day.' },
                            { label: 'A pocket-size cuddle coupon üéüÔ∏è', quote: 'Redeem anytime for one long, warm hug.' },
                            { label: 'All of the above üß∏', quote: 'Because you deserve every cute and cozy thing.' }
                        ]
                    },
                    {
                        prompt: 'When do you want your teddy hug most?',
                        options: [
                            { label: 'Right after waking up üå§Ô∏è', quote: 'A soft start to the day with love in the air.' },
                            { label: 'After a hectic afternoon üåÜ', quote: 'Let me be your pause button and your peace.' },
                            { label: 'Before sleep at night üåô', quote: 'A calm cuddle so your dreams feel safer and sweeter.' },
                            { label: 'Anytime, every time üíû', quote: 'Then I‚Äôll never stop showing up with comfort.' }
                        ]
                    }
                ],
                choices: [
                    'Snuggle bear',
                    'Honey bear',
                    'Moonlight bear',
                    'Heart hug bear'
                ],
                letters: [
                    'If love had a shape, it would be soft and cuddly. I want to be your comfort, your warmth, and your favorite place to rest.',
                    'Whenever you need a safe place, I‚Äôll be your gentle hug, your cozy corner, and your calm.'
                ]
            },
            {
                month: 1,
                day: 11,
                title: 'Promise Day ü§û',
                image: {
                    src: createDecorativeImage('ü§û', 'Promise Day', '#f7b2ff'),
                    alt: 'Pinky promise with floating hearts'
                },
                successImage: {
                    src: createDecorativeImage('üíû', 'Promise Day Promise', '#e6a6ff'),
                    alt: 'Hands linked in a promise'
                },
                loading: {
                    title: 'Sealing your promise moment...',
                    icon: 'ü§ûüí´ü§û',
                    petals: 'üí´'
                },
                message: 'I promise to choose you, respect you, and care for you every day.',
                proposal: 'Will you let me keep a forever promise by your side?',
                questions: [
                    'Can I promise to listen, laugh, and love you better every day?',
                    'Will you hold my hand through every season?',
                    'Can we promise to make each other feel safe and seen?'
                ],
                mcq: [
                    {
                        prompt: 'Which promise should I lead with today?',
                        options: [
                            { label: 'To communicate gently üó£Ô∏è', quote: 'Even in hard moments, I‚Äôll choose kindness and clarity.' },
                            { label: 'To protect your peace üïäÔ∏è', quote: 'I‚Äôll be your calm, not your chaos.' },
                            { label: 'To celebrate your growth üå±', quote: 'I‚Äôll cheer every step you take, big or small.' },
                            { label: 'To do all three ü§ç', quote: 'Then I‚Äôll build love with intention, every single day.' }
                        ]
                    },
                    {
                        prompt: 'What does ‚Äúforever promise‚Äù mean to you?',
                        options: [
                            { label: 'Consistency over grand gestures ü´∂', quote: 'Love is in the steady things we do for each other.' },
                            { label: 'Loyalty through every season üå¶Ô∏è', quote: 'I‚Äôll stay, support, and stand with you no matter what.' },
                            { label: 'Growth as a team ü§ù', quote: 'We keep learning each other and choosing better together.' },
                            { label: 'All of it, always üíç', quote: 'Beautiful‚Äîour promise can be deep, warm, and complete.' }
                        ]
                    }
                ],
                choices: [
                    'Always be honest',
                    'Always be kind',
                    'Always show up',
                    'Always choose you'
                ],
                letters: [
                    'My promise is simple: I will love you in ways that feel steady and true. I‚Äôll be there, with patience, kindness, and a heart that keeps choosing you.',
                    'I promise to hold your heart gently, celebrate your wins, and stand by you when the world feels loud.'
                ]
            },
            {
                month: 1,
                day: 12,
                title: 'Hug Day ü§ó',
                image: {
                    src: createDecorativeImage('ü§ó', 'Hug Day', '#ffc4dd'),
                    alt: 'A warm hug with happy hearts'
                },
                successImage: {
                    src: createDecorativeImage('üíó', 'Hug Day Cuddle', '#ffb6d5'),
                    alt: 'A cozy hug celebration'
                },
                loading: {
                    title: 'Wrapping you in hugs...',
                    icon: 'ü§óüíóü§ó',
                    petals: 'üíû'
                },
                message: 'Let every hug remind you that you‚Äôre cherished, safe, and adored.',
                proposal: 'Can I be the arms you run into whenever you need comfort?',
                questions: [
                    'How many hugs should I owe you today‚Äî10 or 100?',
                    'Can I be the squeeze that turns your day around?',
                    'Will you let me hold you close when words fall short?'
                ],
                mcq: [
                    {
                        prompt: 'Choose your ideal hug moment:',
                        options: [
                            { label: 'A long hello hug ü§ó', quote: 'The kind where the whole day melts away in one embrace.' },
                            { label: 'A reassuring ‚Äúyou got this‚Äù hug üí™', quote: 'A quick squeeze packed with confidence and love.' },
                            { label: 'A quiet, no-words-needed hug üåô', quote: 'Just heartbeat, warmth, and being fully understood.' },
                            { label: 'All hug types unlocked üíñ', quote: 'Perfect, I‚Äôll keep a full hug menu ready for you.' }
                        ]
                    },
                    {
                        prompt: 'What should I whisper during your hug?',
                        options: [
                            { label: '‚ÄúI‚Äôm proud of you.‚Äù ‚ú®', quote: 'Because your effort and heart deserve to be seen.' },
                            { label: '‚ÄúI‚Äôm here for you.‚Äù üå∑', quote: 'No matter what the day brings, I‚Äôm by your side.' },
                            { label: '‚ÄúYou‚Äôre my safe place.‚Äù üè°', quote: 'Loving you feels like home in the best way.' },
                            { label: '‚ÄúAll of the above.‚Äù üíû', quote: 'Then I‚Äôll say it again and again until you feel it deeply.' }
                        ]
                    }
                ],
                choices: [
                    'Morning sunshine hug',
                    'After-work unwind hug',
                    'Quiet midnight hug',
                    'Celebration hug'
                ],
                letters: [
                    'Hugs say what words can‚Äôt: ‚ÄúI‚Äôm here, I‚Äôve got you, and you‚Äôre never alone.‚Äù I hope you feel that in every embrace we share.',
                    'Whenever you‚Äôre tired, I want to hold you close and remind you that you‚Äôre deeply loved.'
                ]
            },
            {
                month: 1,
                day: 13,
                title: 'Kiss Day üíã',
                image: {
                    src: createDecorativeImage('üíã', 'Kiss Day', '#ff9cc6'),
                    alt: 'A sweet kiss with floating sparkles'
                },
                successImage: {
                    src: createDecorativeImage('üòò', 'Kiss Day Blush', '#ff8fbf'),
                    alt: 'A kiss blown with heart sparkles'
                },
                loading: {
                    title: 'Sending you a thousand kisses...',
                    icon: 'üíã‚ú®üíã',
                    petals: '‚ú®'
                },
                message: 'A kiss that says thank you, I love you, and I‚Äôm all yours.',
                proposal: 'Will you be the kiss that makes my heart flutter forever?',
                questions: [
                    'May I steal a sweet kiss and leave a thousand smiles?',
                    'Can I be your favorite hello and goodnight?',
                    'Will you let my kiss say ‚ÄúI love you‚Äù every time?'
                ],
                mcq: [
                    {
                        prompt: 'Pick our kiss-day mood:',
                        options: [
                            { label: 'Shy and blushy üòä', quote: 'A soft smile, a gentle kiss, and butterflies everywhere.' },
                            { label: 'Playful and giggly üòÑ', quote: 'Tiny pecks, big laughs, and endless teasing affection.' },
                            { label: 'Slow and cinematic üéûÔ∏è', quote: 'Like time pauses and it‚Äôs just us in the moment.' },
                            { label: 'All moods, same love üíò', quote: 'Then I‚Äôll love you in every tempo and every tone.' }
                        ]
                    },
                    {
                        prompt: 'Where should your bonus kiss land?',
                        options: [
                            { label: 'Forehead üíã', quote: 'For comfort, care, and quiet devotion.' },
                            { label: 'Cheek üíó', quote: 'For sweetness, warmth, and everyday affection.' },
                            { label: 'Hand ü§ç', quote: 'For respect, tenderness, and old-school romance.' },
                            { label: 'You decide, I deliver ‚ú®', quote: 'Gladly‚Äîyour wish is my favorite love plan.' }
                        ]
                    }
                ],
                choices: [
                    'Forehead kiss',
                    'Cheek kiss',
                    'Hand kiss',
                    'Slow, sweet kiss'
                ],
                letters: [
                    'Every kiss is a tiny promise‚Äîsoft, sincere, and full of devotion. I hope mine always make you feel cherished and adored.',
                    'Let our kisses be little reminders that we belong to each other, today and always.'
                ]
            },
            {
                month: 1,
                day: 14,
                title: 'Valentine‚Äôs Day üíò',
                image: {
                    src: createValentinePenguinImage('Will you be my Valentine?'),
                    alt: 'A cozy penguin with hearts and a Valentine message'
                },
                successImage: {
                    src: createValentinePenguinImage('Best decision ever üíñ'),
                    alt: 'A penguin celebrating with hearts and confetti'
                },
                loading: {
                    title: 'Cueing the Valentine fireworks...',
                    icon: 'üíòüéâüíò',
                    petals: 'üíñ'
                },
                message: 'Today I celebrate you, us, and every day that led here.',
                proposal: 'Will you be my Valentine today, tomorrow, and always?',
                questions: [
                    'Will you be my forever Valentine?',
                    'Can we write a love story that‚Äôs gentle and brave?',
                    'Will you be my today, my tomorrow, and my always?'
                ],
                mcq: [
                    {
                        prompt: 'How should we celebrate our Valentine moment?',
                        options: [
                            { label: 'A candlelit dinner üçΩÔ∏è', quote: 'Slow conversation, warm lights, and eyes only for you.' },
                            { label: 'A rooftop or terrace under stars üåå', quote: 'Just us, night air, and promises whispered close.' },
                            { label: 'A cozy at-home date night üõãÔ∏è', quote: 'Soft music, shared dessert, and love in its comfiest form.' },
                            { label: 'Whatever includes us together üíû', quote: 'Perfect choice‚Äîbeing with you is the real celebration.' }
                        ]
                    },
                    {
                        prompt: 'What should our next love chapter focus on?',
                        options: [
                            { label: 'More quality time ‚è≥', quote: 'Intentional moments that feel full and meaningful.' },
                            { label: 'More adventures üåç', quote: 'New places, new memories, same hand to hold.' },
                            { label: 'More deep talks üí¨', quote: 'Heart-to-heart conversations that keep us close.' },
                            { label: 'All three, please üíñ', quote: 'Then our story keeps getting richer in every way.' }
                        ]
                    }
                ],
                choices: [
                    'A candlelit dinner',
                    'A stargazing date',
                    'A handwritten letter',
                    'A slow dance at home'
                ],
                letters: [
                    'Valentine‚Äôs Day is just one day, but loving you is my favorite everyday. Thank you for being my calm, my joy, and my home.',
                    'I want to keep choosing you, celebrating you, and loving you in all the small and beautiful ways.'
                ]
            }
        ];

        const getTodayKey = () => {
            const now = new Date();
            return { month: now.getMonth(), day: now.getDate() };
        };

        const buildPreviousDays = (currentIndex) => {
            const previousDays = valentineWeek.slice(0, currentIndex).map((entry) => `
                <li><strong>${entry.title}:</strong> ${entry.proposal}</li>
            `).join('');

            return `
                <p>Here‚Äôs a replay of every love note that led to today:</p>
                <ul>${previousDays}</ul>
            `;
        };

        const todayKey = getTodayKey();
        const todayIndex = valentineWeek.findIndex(
            (entry) => entry.month === todayKey.month && entry.day === todayKey.day
        );

        const defaultDay = {
            title: 'Everyday Love ‚ú®',
            image: {
                src: createDecorativeImage('üíñ', 'Everyday Love', '#ffd1e8'),
                alt: 'A cozy love scene for any day'
            },
            successImage: {
                src: createDecorativeImage('üéâ', 'Everyday Love Cheers', '#ffc4dd'),
                alt: 'A cheerful celebration for an everyday yes'
            },
            loading: {
                title: 'Getting your love dashboard ready...',
                icon: 'üíñ‚ú®üíñ',
                petals: 'üíó'
            },
            message: 'Even outside Valentine‚Äôs week, I‚Äôm still choosing you with my whole heart.',
            proposal: 'Will you keep this love story close until next Valentine‚Äôs Day?',
            questions: [
                'Can we plan a tiny date just for us?',
                'Which song reminds you of us right now?',
                'Can I send you a sweet message today?'
            ],
            choices: [
                'A cozy coffee date',
                'A sunset walk',
                'A movie night',
                'A handwritten note'
            ],
            letters: [
                'No special day is required for loving you. I want to keep showing up in all the small ways that make your heart feel safe and treasured.',
                'Until Valentine‚Äôs week arrives again, let‚Äôs keep building our love with laughter, patience, and gentle moments.'
            ]
        };

        let activeTab = 'questions';
        let selectedChoiceIndex = null;
        let letterIndex = 0;
        let isLetterOpen = false;

        const getTodayEntry = () => (todayIndex === -1 ? defaultDay : valentineWeek[todayIndex]);

        const renderTabContent = () => {
            const todayEntry = getTodayEntry();

            if (activeTab === 'questions') {
                pageBody.innerHTML = `
                    <ul class="question-list">
                        ${todayEntry.questions.map((question) => `<li>${question}</li>`).join('')}
                    </ul>
                `;
            }

            if (activeTab === 'choices') {
                pageBody.innerHTML = `
                    <div class="choice-grid">
                        ${todayEntry.choices.map((choice, index) => `
                            <button class="choice-button ${selectedChoiceIndex === index ? 'selected' : ''}" type="button" data-choice="${index}">
                                ${choice}
                            </button>
                        `).join('')}
                    </div>
                    <p>${selectedChoiceIndex === null ? 'Pick a little love surprise.' : `You chose: ${todayEntry.choices[selectedChoiceIndex]} üíñ`}</p>
                `;

                pageBody.querySelectorAll('.choice-button').forEach((button) => {
                    button.addEventListener('click', () => {
                        selectedChoiceIndex = Number(button.dataset.choice);
                        const selectedChoice = todayEntry.choices[selectedChoiceIndex];
                        trackEvent('daily_choice_selected', {
                            day_title: todayEntry.title,
                            choice_index: selectedChoiceIndex,
                            choice_text: selectedChoice
                        });
                        renderTabContent();
                    });
                });
            }

            pageContent.classList.remove('animate');
            void pageContent.offsetWidth;
            pageContent.classList.add('animate');
        };

        const renderTabs = () => {
            const tabs = [
                { id: 'questions', label: 'Questions üí¨' },
                { id: 'choices', label: 'Choices üéÄ' }
            ];

            contentTabs.innerHTML = tabs.map((tab) => `
                <button class="content-tab ${activeTab === tab.id ? 'active' : ''}" data-tab="${tab.id}" type="button">
                    ${tab.label}
                </button>
            `).join('');

            contentTabs.querySelectorAll('.content-tab').forEach((tab) => {
                tab.addEventListener('click', () => {
                    activeTab = tab.dataset.tab;
                    trackEvent('tab_changed', { tab_name: activeTab, day_title: getTodayEntry().title });
                    startTabTimer(activeTab);
                    renderTabs();
                    renderTabContent();
                });
            });
        };

        const updateDayContent = () => {
            const todayEntry = getTodayEntry();
            const isValentineToday = todayIndex === valentineWeek.length - 1;
            const displayImage = document.getElementById('display-image');

            dayLabel.textContent = 'Today is';
            dayTitle.textContent = todayEntry.title;
            dayMessage.textContent = todayEntry.message;
            setImageWithFallback(
                displayImage,
                todayEntry.image?.src || defaultDay.image.src,
                todayEntry.image?.alt || defaultDay.image.alt,
                todayEntry.title
            );

            if (isValentineToday) {
                dayExtra.innerHTML = buildPreviousDays(valentineWeek.length - 1);
                dayReminder.textContent = 'Happy Valentine‚Äôs Day! Relive every sweet promise again. üíñ';
            } else {
                dayExtra.textContent = todayEntry.proposal;
                dayReminder.textContent = todayIndex === -1
                    ? 'Come back next Valentine‚Äôs Day for a brand-new wave of love. üíå'
                    : 'Come back tomorrow for a brand-new love surprise. üíû';
            }

            if (todayIndex === -1) {
                seasonNote.hidden = false;
                seasonNote.textContent = 'It‚Äôs not Valentine‚Äôs week yet‚Äîthis page is a little love preview just for you.';
            } else {
                seasonNote.hidden = true;
            }

            pageTitle.textContent = `${todayEntry.title} Love Page`;
            pageCount.textContent = todayIndex === -1 ? 'Love note for today' : 'Today‚Äôs page';
            todayBadge.textContent = 'Today‚Äôs pick üíñ';
            todayBadge.style.opacity = '1';

            renderTabs();
            renderTabContent();
            startTabTimer(activeTab);
            trackEvent('day_content_rendered', {
                day_index: todayIndex,
                day_title: todayEntry.title,
                active_tab: activeTab
            });
        };

        updateDayContent();

        const buildLoadingMarkup = (todayEntry) => {
            const loading = todayEntry.loading || defaultDay.loading;
            const dayThemeLabel = todayEntry.title || 'Valentine‚Äôs Day';
            const loadingSymbols = [loading.petals, 'üíó', 'üå∏', 'üåπ', 'üíñ', 'üå∑'];
            const petals = Array.from({ length: 8 }).map((_, index) => {
                const left = 10 + index * 10;
                const delay = (index * -0.35).toFixed(2);
                const duration = (2.4 + (index % 4) * 0.4).toFixed(2);
                const symbol = loadingSymbols[index % loadingSymbols.length];
                return `<span class="petal" style="left:${left}%; animation-delay:${delay}s; --fall-duration:${duration}s;">${symbol}</span>`;
            }).join('');
            const themedMarkup = `
                <div class="promise-display">
                    <div class="promise-loader-stage" aria-hidden="true">
                        <div class="petal-field">
                            ${petals}
                        </div>
                        <canvas class="promise-loader-canvas" width="240" height="140"></canvas>
                        <div class="promise-symbols">
                            <span class="promise-symbol teddy">üß∏</span>
                            <span class="promise-symbol flower">üå∏</span>
                            <span class="promise-symbol heart">üíó</span>
                        </div>
                    </div>
                    <div class="hug-hearts">üíû ‚ú® üíû</div>
                </div>
            `;

            return `
                <div class="loading-screen">
                    <h2 class="loading-title">${loading.title}</h2>
                    <p class="loading-theme">Today‚Äôs theme: ${dayThemeLabel}</p>
                    <div class="loading-heart" aria-hidden="true">üíñ</div>
                    <div class="loading-icon">${loading.icon}</div>
                    <p class="loading-subtitle">Hold on, love is on the way...</p>
                    ${themedMarkup}
                </div>
            `;
        };

        const createPromiseLoaderAnimation = (overlay) => {
            const canvas = overlay.querySelector('.promise-loader-canvas');
            if (!canvas) {
                return;
            }

            const ctx = canvas.getContext('2d');
            if (!ctx) {
                return;
            }

            const pointCount = innerWidth < 600 ? 360 : 520;
            const particles = Array.from({ length: pointCount }, () => ({ x: 0, y: 0 }));
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const phaseDuration = 1200;
            const start = performance.now();
            let rafId = 0;

            const heartShape = (t) => {
                const sine = Math.sin(t);
                return {
                    x: 16 * Math.pow(sine, 3),
                    y: 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t)
                };
            };

            const roseShape = (t) => {
                const radius = Math.sin(5 * t);
                return {
                    x: radius * Math.cos(t) * 24,
                    y: -radius * Math.sin(t) * 24
                };
            };

            const leftHandShape = (t) => ({
                x: -34 + 16 * Math.cos(t),
                y: 14 * Math.sin(t)
            });

            const rightHandShape = (t) => ({
                x: 34 - 16 * Math.cos(t),
                y: 14 * Math.sin(t)
            });

            const drawFrame = (now) => {
                const elapsed = now - start;
                const phase = Math.min(3, Math.floor(elapsed / phaseDuration));
                const phaseProgress = Math.min(1, (elapsed % phaseDuration) / phaseDuration);
                const pulse = 1 + Math.sin(elapsed * 0.01) * 0.12;

                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = 'rgba(233, 30, 99, 0.9)';

                for (let i = 0; i < pointCount; i += 1) {
                    const t = (i / pointCount) * Math.PI * 2;
                    let targetX = 0;
                    let targetY = 0;

                    if (phase === 0) {
                        const p = roseShape(t);
                        targetX = p.x * phaseProgress * 2.2;
                        targetY = p.y * phaseProgress * 2.2;
                    } else if (phase === 1) {
                        const p = heartShape(t);
                        targetX = p.x * phaseProgress * 1.9;
                        targetY = p.y * phaseProgress * 1.9;
                    } else if (phase === 2) {
                        const p = i % 2 === 0 ? leftHandShape(t) : rightHandShape(t);
                        targetX = p.x * phaseProgress;
                        targetY = p.y * phaseProgress;
                    } else {
                        const radius = 28 + Math.sin(elapsed * 0.012) * 5;
                        targetX = Math.cos(t) * radius;
                        targetY = Math.sin(t) * radius;
                    }

                    const particle = particles[i];
                    particle.x += (targetX - particle.x) * 0.12;
                    particle.y += (targetY - particle.y) * 0.12;

                    const size = 1.1 + pulse * 0.6;
                    ctx.beginPath();
                    ctx.arc(centerX + particle.x, centerY + particle.y, size, 0, Math.PI * 2);
                    ctx.fill();
                }

                if (elapsed < 5000) {
                    rafId = requestAnimationFrame(drawFrame);
                }
            };

            rafId = requestAnimationFrame(drawFrame);
            overlay.dataset.promiseRaf = String(rafId);
        };

        const stopPromiseLoaderAnimation = (overlay) => {
            const rafValue = Number(overlay?.dataset?.promiseRaf);
            if (Number.isFinite(rafValue) && rafValue > 0) {
                cancelAnimationFrame(rafValue);
            }
        };

        const showInitialLoading = () => {
            const todayEntry = getTodayEntry();
            startSectionTimer('initial_overlay_loading');
            trackEvent('initial_loading_shown', { day_title: todayEntry.title });
            const overlay = document.createElement('div');
            overlay.className = 'initial-loading-overlay';
            overlay.innerHTML = buildLoadingMarkup(todayEntry);
            document.body.appendChild(overlay);

            createPromiseLoaderAnimation(overlay);

            setTimeout(() => {
                stopPromiseLoaderAnimation(overlay);
                overlay.remove();
                startSectionTimer('landing_page');
                trackEvent('landing_page_ready', { day_title: todayEntry.title });
            }, 5000);
        };

        const renderLoadingPage = () => {
            startSectionTimer('transition_loading_page');
            trackEvent('transition_loading_shown');
            startBgmAfterYes();
            container.innerHTML = `
                <div class="loading-screen">
                    <div class="loading-heart" aria-hidden="true">üíñ</div>
                    <p class="loading-subtitle">Loading your next page...</p>
                </div>
            `;

            setTimeout(renderQuestionPage, 2000);
        };

        showInitialLoading();

        const renderQuestionPage = () => {
            const todayEntry = getTodayEntry();
            startSectionTimer('question_page');
            trackEvent('question_page_viewed', { day_title: todayEntry.title });
            container.innerHTML = `
                <div class="success-content">
                    <h2 class="success-title">${todayEntry.title} Questions üíû</h2>
                    <p class="success-subtitle">Answer just one, or let me know which feels the sweetest.</p>
                    <div class="success-questions">
                        <h3>Today‚Äôs love questions</h3>
                        ${
                            todayEntry.mcq?.length
                                ? todayEntry.mcq.map((item, index) => `
                                    <div class="mcq-item" data-question="${index}">
                                        <p class="mcq-question">${item.prompt}</p>
                                        <div class="choice-grid">
                                            ${item.options.map((option, optionIndex) => `
                                                <button class="choice-button" type="button" data-question="${index}" data-option="${optionIndex}">
                                                    ${option.label}
                                                </button>
                                            `).join('')}
                                        </div>
                                        <div class="mcq-quote" data-quote="${index}" hidden></div>
                                    </div>
                                `).join('')
                                : `
                                    <ul>
                                        ${todayEntry.questions.map((question) => `<li>${question}</li>`).join('')}
                                    </ul>
                                `
                        }
                    </div>
                    <div class="success-message">
                        Your answers are my favorite love notes. I‚Äôm all ears and all heart.
                    </div>
                    <div class="success-actions">
                        <button class="choice-button" id="go-back" type="button">Go back</button>
                        <button class="choice-button selected" id="to-success" type="button">Next page ‚Üí</button>
                    </div>
                </div>
            `;

            document.getElementById('go-back').addEventListener('click', () => {
                trackEvent('question_go_back_clicked', { day_title: todayEntry.title });
                window.location.reload();
            });

            document.getElementById('to-success').addEventListener('click', () => {
                trackEvent('question_next_clicked', { day_title: todayEntry.title });
                renderSuccessPage();
            });

            if (todayEntry.mcq?.length) {
                container.querySelectorAll('.choice-button[data-question]').forEach((button) => {
                    button.addEventListener('click', () => {
                        const questionIndex = Number(button.dataset.question);
                        const optionIndex = Number(button.dataset.option);
                        const questionBlock = container.querySelector(`.mcq-item[data-question="${questionIndex}"]`);
                        const quoteBox = container.querySelector(`.mcq-quote[data-quote="${questionIndex}"]`);
                        const option = todayEntry.mcq[questionIndex].options[optionIndex];

                        questionBlock.querySelectorAll('.choice-button').forEach((choice) => {
                            choice.classList.toggle('selected', choice === button);
                        });

                        quoteBox.textContent = `‚Äú${option.quote}‚Äù`;
                        quoteBox.hidden = false;

                        trackEvent('mcq_answer_selected', {
                            day_title: todayEntry.title,
                            question_index: questionIndex,
                            option_index: optionIndex,
                            option_label: option.label
                        });
                    });
                });
            }
        };

        const renderSuccessPage = () => {
            const todayEntry = getTodayEntry();
            startSectionTimer('success_page');
            trackEvent('success_page_viewed', { day_title: todayEntry.title });
            const successImage = todayEntry.successImage?.src || todayEntry.image?.src || defaultDay.successImage.src;
            const successAlt = todayEntry.successImage?.alt || todayEntry.image?.alt || defaultDay.successImage.alt;
            const whatsappMessage = encodeURIComponent('Love you too, Chandu ‚ù§Ô∏è');
            isLetterOpen = false;
            letterIndex = 0;

            container.innerHTML = `
                <div class="success-content">
                    <h2 class="success-title">Best decision ever üíñ</h2>
                    <p class="success-subtitle">You just made my whole day sparkle.</p>
                    <img src="${successImage}" alt="${successAlt}" style="border-radius: 14px; margin-bottom: 14px;">
                    <div class="success-message">
                        I‚Äôll keep choosing you in the little moments and the big ones. Thank you for saying yes to this love.
                    </div>
                    <div class="success-letters">
                        <h3>Love letters for today</h3>
                        <div class="letter-card">
                            <button class="letter-seal" id="success-open-letter" type="button" aria-expanded="false">
                                <span class="letter-icon">üíå</span>
                                <span class="letter-title">Click to open today‚Äôs love letter</span>
                                <span class="letter-subtitle">A sweet note is waiting inside.</span>
                            </button>
                            <div class="letter-content" hidden>
                                <div class="love-letter">${todayEntry.letters[letterIndex]}</div>
                                <div class="page-footer">
                                    <span>Letter ${letterIndex + 1} of ${todayEntry.letters.length}</span>
                                    <button class="choice-button" id="success-next-letter" type="button">Next letter ‚Üí</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <p class="final-note">Now come collect your hugs, kisses, and a lifetime of dates.</p>
                    <div class="success-actions">
                        <a class="choice-button selected" id="whatsapp-cta" href="https://wa.me/7093349948?text=${whatsappMessage}" target="_blank" rel="noopener">
                            Send ‚ÄúLove you too‚Äù to Chandu ‚ù§Ô∏è
                        </a>
                    </div>
                </div>
            `;

            const successImg = container.querySelector('.success-content img');
            setImageWithFallback(
                successImg,
                successImage,
                successAlt,
                todayEntry.title
            );

            const whatsappButton = document.getElementById('whatsapp-cta');
            whatsappButton?.addEventListener('click', () => {
                trackEvent('whatsapp_cta_clicked', { day_title: todayEntry.title });
            });

            const openLetterButton = document.getElementById('success-open-letter');
            const letterTitle = openLetterButton.querySelector('.letter-title');
            const letterSubtitle = openLetterButton.querySelector('.letter-subtitle');
            const letterContent = container.querySelector('.letter-content');

            openLetterButton.addEventListener('click', () => {
                isLetterOpen = !isLetterOpen;
                trackEvent('love_letter_toggled', {
                    day_title: todayEntry.title,
                    is_open: isLetterOpen
                });
                openLetterButton.classList.toggle('opened', isLetterOpen);
                openLetterButton.setAttribute('aria-expanded', String(isLetterOpen));
                letterContent.hidden = !isLetterOpen;
                letterTitle.textContent = isLetterOpen
                    ? 'Click to close today‚Äôs love letter'
                    : 'Click to open today‚Äôs love letter';
                letterSubtitle.textContent = isLetterOpen
                    ? 'Keep it close, then tuck it back in.'
                    : 'A sweet note is waiting inside.';
            });

            const nextLetterButton = document.getElementById('success-next-letter');
            nextLetterButton.addEventListener('click', () => {
                letterIndex = (letterIndex + 1) % todayEntry.letters.length;
                trackEvent('love_letter_next_clicked', {
                    day_title: todayEntry.title,
                    letter_index: letterIndex + 1,
                    total_letters: todayEntry.letters.length
                });
                container.querySelector('.love-letter').textContent = todayEntry.letters[letterIndex];
                container.querySelector('.page-footer span').textContent = `Letter ${letterIndex + 1} of ${todayEntry.letters.length}`;
            });

            document.getElementById('main-card').style.backgroundColor = 'transparent';
            document.getElementById('main-card').style.boxShadow = 'none';
        };

        // 1. Logic for the runaway "No" button
        const moveNoButton = () => {
            const padding = 16;
            const maxX = window.innerWidth - noBtn.offsetWidth - padding;
            const maxY = window.innerHeight - noBtn.offsetHeight - padding;
            const x = Math.max(padding, Math.random() * Math.max(maxX, padding));
            const y = Math.max(padding, Math.random() * Math.max(maxY, padding));

            noBtn.style.position = 'fixed';
            noBtn.style.left = `${x}px`;
            noBtn.style.top = `${y}px`;
        };

        const handleNoInteraction = (event) => {
            event.preventDefault();
            trackEvent('no_button_interaction', { trigger_type: event.type });
            event.stopPropagation();
            const randomMessage = noMessages[Math.floor(Math.random() * noMessages.length)];
            speakMessage(randomMessage);
            moveNoButton();
        };

        noBtn.addEventListener('mouseover', moveNoButton);
        noBtn.addEventListener('touchstart', handleNoInteraction, { passive: false });
        noBtn.addEventListener('click', handleNoInteraction);

        const createBurst = () => {
            const burst = document.createElement('span');
            burst.classList.add('burst-heart');
            burst.textContent = 'üíñ';
            const angle = Math.random() * Math.PI * 2;
            const distance = 80 + Math.random() * 60;
            burst.style.setProperty('--x', `${Math.cos(angle) * distance}px`);
            burst.style.setProperty('--y', `${Math.sin(angle) * distance}px`);
            const rect = yesBtn.getBoundingClientRect();
            burst.style.left = `${rect.left + rect.width / 2}px`;
            burst.style.top = `${rect.top + rect.height / 2}px`;
            document.body.appendChild(burst);
            burst.addEventListener('animationend', () => burst.remove());
        };

        yesBtn.addEventListener('mouseenter', () => {
            trackEvent('yes_button_hovered');
            createBurst();
        });

        // 2. Logic for the "Yes" click (loading ‚Üí question page ‚Üí success page)
        yesBtn.addEventListener('click', () => {
            trackEvent('yes_button_clicked');
            startSectionTimer('yes_clicked_transition');
            speakMessage('Sindhu, I love you.');
            setTimeout(renderLoadingPage, 600);
        });


        window.addEventListener('beforeunload', () => {
            const now = performance.now();

            if (sectionTiming.currentSection) {
                const durationMs = Math.round(now - sectionTiming.sectionStart);
                trackEvent('section_time_spent', {
                    section_name: sectionTiming.currentSection,
                    duration_ms: durationMs,
                    duration_seconds: Number((durationMs / 1000).toFixed(2)),
                    unload: true
                });
            }

            if (sectionTiming.currentTab) {
                const tabDurationMs = Math.round(now - sectionTiming.tabStart);
                trackEvent('tab_time_spent', {
                    tab_name: sectionTiming.currentTab,
                    duration_ms: tabDurationMs,
                    duration_seconds: Number((tabDurationMs / 1000).toFixed(2)),
                    unload: true
                });
            }

            trackEvent('experience_closed', {
                visitor_id: visitorId,
                session_id: sessionId
            });
        });
    </script>
</body>
</html>
